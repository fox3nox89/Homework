<!DOCTYPE html>
<html lang="de-CH">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathe ‚Äì Rechen-Quest</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts / Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>

<body>

    <!-- WALD-HINTERGRUND (optional, kindgerecht) -->
    <div class="blob bg-blue-200 w-64 h-64 top-0 left-0"></div>
    <div class="blob bg-yellow-200 w-64 h-64 bottom-0 right-0"></div>

    <div class="app-page-wrapper">

        <!-- ================================
             GLOBALES LEVEL / COINS HUD
        =================================== -->
        <div class="flex justify-between items-center mb-6">

            <div>
                <div class="font-fun text-3xl font-black text-slate-800">
                    Mathe ‚Äì Rechen-Quest üßÆ
                </div>
                <div class="text-slate-600 font-bold">Werde st√§rker, indem du Aufgaben l√∂st!</div>
            </div>

            <div class="text-right">
                <div class="badge badge-blue mb-1">Level: <span id="level">1</span></div><br>
                <div class="badge badge-yellow">Coins: <span id="coins">0</span></div>
            </div>

        </div>

        <!-- XP-Bar -->
        <div class="xp-bar mb-8">
            <div class="xp-bar-fill" id="xpBar"></div>
        </div>


        <!-- ================================
             MATHE ‚Äì QUIZ BEREICH
        =================================== -->

        <div class="glass-panel p-6 mt-4">
            <h2 class="font-fun text-2xl font-black mb-4">Neue Aufgabe:</h2>

            <div id="task" class="text-4xl font-black text-center my-6"></div>

            <input 
                id="answer"
                type="number" 
                class="w-full text-center text-3xl p-4 rounded-xl border-4 border-slate-300 focus:border-blue-500 outline-none transition-all"
                placeholder="Deine Antwort..."
            >

            <button id="submitAnswer" class="btn-action btn-green w-full mt-5 py-4 text-xl">
                Antwort pr√ºfen
            </button>

            <div id="feedback" class="text-center font-fun text-xl mt-4"></div>
        </div>


        <!-- ================================
             LEVEL-UP POPUP
        =================================== -->

        <div id="levelUpPopup" class="modal-overlay hidden">
            <div class="glass-panel p-10 text-center pop-in">

                <h2 class="font-fun text-4xl font-black text-green-400 mb-4">LEVEL UP!</h2>
                <p class="text-xl text-white mb-6">Du bist jetzt Level <span id="newLevel"></span>! ‚≠ê</p>

                <button id="closePopup" class="btn-action btn-blue w-full py-3 text-xl">Weiter</button>
            </div>
        </div>

    </div> <!-- wrapper end -->


    <!-- ================================
         GLOBAL GAME ENGINE (XP / LEVEL)
    =================================== -->

    <script>
        /* =============================
           SPEICHER / RPG SYSTEM
        ============================== */

        const player = {
            level: parseInt(localStorage.getItem("lc_level")) || 1,
            xp: parseInt(localStorage.getItem("lc_xp")) || 0,
            coins: parseInt(localStorage.getItem("lc_coins")) || 0,
        };

        function requiredXP(level) {
            // RPG-Levelkurve (leicht steigend)
            return Math.floor(30 * Math.pow(1.45, level - 1));
        }

        function saveData() {
            localStorage.setItem("lc_level", player.level);
            localStorage.setItem("lc_xp", player.xp);
            localStorage.setItem("lc_coins", player.coins);
        }

        function updateHUD() {
            document.getElementById("level").textContent = player.level;
            document.getElementById("coins").textContent = player.coins;

            const req = requiredXP(player.level);
            const percent = Math.min(100, (player.xp / req) * 100);
            document.getElementById("xpBar").style.width = percent + "%";
        }

        function addXP(amount) {
            player.xp += amount;
            player.coins += Math.floor(amount / 5); // Bonus Coins
            checkLevelUp();
            saveData();
            updateHUD();
        }

        function checkLevelUp() {
            const req = requiredXP(player.level);
            while (player.xp >= req) {
                player.xp -= req;
                player.level++;
                showLevelUpPopup(player.level);
            }
        }

        function showLevelUpPopup(lvl) {
            document.getElementById("newLevel").textContent = lvl;
            document.getElementById("levelUpPopup").classList.remove("hidden");
        }

        document.getElementById("closePopup").addEventListener("click", () => {
            document.getElementById("levelUpPopup").classList.add("hidden");
        });


        /* =============================
           MATHE ‚Äì AUFGABEN SYSTEM
        ============================== */

        let currentAnswer = 0;

        function newTask() {
            const a = Math.floor(Math.random() * 20 + 1);
            const b = Math.floor(Math.random() * 20 + 1);

            const ops = ["+", "-", "√ó"];
            const op = ops[Math.floor(Math.random() * ops.length)];

            let result = 0;

            if (op === "+") result = a + b;
            if (op === "-") result = a - b;
            if (op === "√ó") result = a * b;

            currentAnswer = result;

            document.getElementById("task").textContent = `${a} ${op} ${b}`;
        }

        document.getElementById("submitAnswer").addEventListener("click", () => {
            const user = parseInt(document.getElementById("answer").value);
            const feedback = document.getElementById("feedback");

            if (isNaN(user)) {
                feedback.textContent = "Bitte gib eine Zahl ein!";
                feedback.className = "text-red-500 font-fun text-xl";
                return;
            }

            if (user === currentAnswer) {

                // XP je nach Schwierigkeit
                let xpGain = 5;

                if (Math.abs(currentAnswer) > 20) xpGain = 8;
                if (Math.abs(currentAnswer) > 50) xpGain = 12;

                feedback.textContent = `Richtig! üéâ (+${xpGain} XP)`;
                feedback.className = "text-green-500 font-fun text-xl";

                addXP(xpGain);

            } else {
                feedback.textContent = "Falsch! Versuch es nochmal! ‚ùå";
                feedback.className = "text-red-500 font-fun text-xl shake";
            }

            document.getElementById("answer").value = "";
            setTimeout(newTask, 700);
        });

        // START
        updateHUD();
        newTask();
    </script>

</body>
</html>
