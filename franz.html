<!DOCTYPE html>
<html lang="de-CH">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Franz√∂sisch Ultimate</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700&display=swap');
        
        body { 
            font-family: 'Fredoka', sans-serif; 
            background-color: #eef2ff; 
            color: #312e81; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .nunito { font-family: 'Nunito', sans-serif; }
        
        /* Card Styles mit Farb-Codierung */
        .word-card {
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            text-align: center; font-size: 1.1rem; font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1); cursor: pointer; transition: all 0.1s;
            min-height: 90px; position: relative; overflow: hidden;
        }
        .word-card:active { transform: translateY(4px); box-shadow: 0 0 0 transparent; }
        
        /* Franz√∂sisch: Blau */
        .card-fr { background: #eff6ff; border: 2px solid #bfdbfe; color: #1e3a8a; }
        .card-fr.selected { background: #2563eb; border-color: #1d4ed8; color: white; }
        
        /* Deutsch: Orange */
        .card-de { background: #fff7ed; border: 2px solid #fed7aa; color: #7c2d12; }
        .card-de.selected { background: #ea580c; border-color: #c2410c; color: white; }

        .word-card.matched { transform: scale(0); opacity: 0; transition: all 0.5s; pointer-events: none; }
        .word-card.wrong { animation: shake 0.4s; border-color: #ef4444; background: #fee2e2; }

        .flag-icon { font-size: 0.8rem; position: absolute; top: 4px; right: 6px; opacity: 0.7; }
        
        /* Animations */
        @keyframes shake { 10%, 90% { transform: translateX(-2px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }
        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .xp-bar { transition: width 1s ease-out; }
        
        /* Quiz Button */
        .quiz-btn {
            background: white; border: 2px solid #e0e7ff; border-radius: 12px; padding: 15px;
            font-weight: bold; text-align: left; box-shadow: 0 4px 0 #c7d2fe;
            transition: all 0.2s;
        }
        .quiz-btn:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DATENBANK (Erweitert) ---
        const VOCABULARY = [
            // Begr√ºssung
            { fr: "Bonjour", de: "Guten Tag" }, { fr: "Salut", de: "Hallo" }, { fr: "Au revoir", de: "Auf Wiedersehen" },
            { fr: "√áa va?", de: "Wie geht es?" }, { fr: "Merci", de: "Danke" }, { fr: "S'il vous pla√Æt", de: "Bitte" },
            
            // Pronomen
            { fr: "Je", de: "Ich" }, { fr: "Tu", de: "Du" }, { fr: "Il", de: "Er" }, { fr: "Elle", de: "Sie" },
            { fr: "Nous", de: "Wir" }, { fr: "Vous", de: "Ihr" }, { fr: "Ils", de: "Sie (Mehrzahl)" },
            
            // Wichtige W√∂rter
            { fr: "Et", de: "Und" }, { fr: "Ou", de: "Oder" }, { fr: "Mais", de: "Aber" }, { fr: "Oui", de: "Ja" }, { fr: "Non", de: "Nein" },
            { fr: "D'abord", de: "Zuerst" }, { fr: "Puis", de: "Dann" }, { fr: "Apr√®s", de: "Danach" }, { fr: "Finalement", de: "Schliesslich" },
            { fr: "Peut-√™tre", de: "Vielleicht" }, { fr: "Toujours", de: "Immer" }, { fr: "Jamais", de: "Nie" },
            
            // Schule & Nomen
            { fr: "L'√©cole", de: "Die Schule" }, { fr: "Le livre", de: "Das Buch" }, { fr: "Le cahier", de: "Das Heft" },
            { fr: "Le crayon", de: "Der Bleistift" }, { fr: "La gomme", de: "Der Gummi" }, { fr: "Le chien", de: "Der Hund" }, 
            { fr: "La maison", de: "Das Haus" }, { fr: "La fen√™tre", de: "Das Fenster" }, { fr: "La porte", de: "Die T√ºr" },
            
            // Farben
            { fr: "Rouge", de: "Rot" }, { fr: "Bleu", de: "Blau" }, { fr: "Vert", de: "Gr√ºn" }, { fr: "Jaune", de: "Gelb" },
            { fr: "Noir", de: "Schwarz" }, { fr: "Blanc", de: "Weiss" }, 
            
            // Zahlen
            { fr: "Un", de: "Eins" }, { fr: "Deux", de: "Zwei" }, { fr: "Trois", de: "Drei" }, { fr: "Quatre", de: "Vier" },
            { fr: "Cinq", de: "F√ºnf" }, { fr: "Six", de: "Sechs" }, { fr: "Sept", de: "Sieben" }, { fr: "Huit", de: "Acht" },
            { fr: "Neuf", de: "Neun" }, { fr: "Dix", de: "Zehn" }
        ];

        const AVATARS = [
            { id: 'bear', icon: 'üêª', name: 'Bruno', cost: 0 },
            { id: 'cat', icon: 'üê±', name: 'Mimi', cost: 50 },
            { id: 'fox', icon: 'ü¶ä', name: 'Foxy', cost: 100 },
            { id: 'lion', icon: 'ü¶Å', name: 'Leo', cost: 200 },
            { id: 'robot', icon: 'ü§ñ', name: 'Robo', cost: 300 },
            { id: 'alien', icon: 'üëΩ', name: 'Zorg', cost: 500 },
            { id: 'king', icon: 'üëë', name: 'King', cost: 1000 }
        ];

        const LEVELS = [0, 100, 300, 600, 1000, 1500, 2200, 3000, 5000];

        // --- HELPER ---
        const speak = (txt) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'fr-FR'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        };

        const safeConfetti = () => {
            if (window.confetti) window.confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        };

        // --- COMPONENTS ---
        
        // 1. MEMORY GAME
        const MemoryGame = ({ onFinish }) => {
            const [cards, setCards] = useState([]);
            const [selected, setSelected] = useState(null);
            const [matches, setMatches] = useState(0);
            const [wrongPair, setWrongPair] = useState([]);

            useEffect(() => {
                const selection = [...VOCABULARY].sort(() => Math.random() - 0.5).slice(0, 6);
                const deck = [];
                selection.forEach(pair => {
                    deck.push({ id: pair.fr, txt: pair.fr, type: 'fr', pairId: pair.fr });
                    deck.push({ id: pair.fr + '_de', txt: pair.de, type: 'de', pairId: pair.fr });
                });
                setCards(deck.sort(() => Math.random() - 0.5));
            }, []);

            const handleCardClick = (card) => {
                if (card.matched || wrongPair.length > 0 || (selected && selected.id === card.id)) return;
                
                if (card.type === 'fr') speak(card.txt);

                if (!selected) {
                    setSelected(card);
                } else {
                    if (selected.pairId === card.pairId) {
                        setCards(cards.map(c => (c.id === card.id || c.id === selected.id) ? { ...c, matched: true } : c));
                        setSelected(null);
                        setMatches(m => m + 1);
                        if (matches + 1 === 6) setTimeout(onFinish, 1000);
                    } else {
                        setWrongPair([selected.id, card.id]);
                        setTimeout(() => {
                            setWrongPair([]);
                            setSelected(null);
                        }, 1000);
                    }
                }
            };

            return (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    {cards.map((c, i) => (
                        <div key={i} onClick={() => handleCardClick(c)} 
                            className={`word-card ${c.type==='fr'?'card-fr':'card-de'} ${selected?.id===c.id ? 'selected' : ''} ${wrongPair.includes(c.id) ? 'wrong' : ''} ${c.matched ? 'matched' : ''}`}>
                            <span className="flag-icon">{c.type === 'fr' ? 'üá´üá∑' : 'üá©üá™'}</span>
                            {c.txt}
                        </div>
                    ))}
                </div>
            );
        };

        // 2. QUIZ GAME
        const QuizGame = ({ onCorrect, onFinish }) => {
            const [question, setQuestion] = useState(null);

            const nextQ = () => {
                const target = VOCABULARY[Math.floor(Math.random() * VOCABULARY.length)];
                // 3 falsche Antworten holen
                const distractors = VOCABULARY.filter(w => w.fr !== target.fr).sort(() => Math.random() - 0.5).slice(0, 3);
                const options = [...distractors, target].sort(() => Math.random() - 0.5);
                setQuestion({ target, options });
                speak(target.fr);
            };

            useEffect(() => nextQ(), []);

            const check = (opt) => {
                if(opt.fr === question.target.fr) {
                    onCorrect();
                    nextQ(); // N√§chste Frage sofort
                } else {
                    alert(`Falsch! ${question.target.fr} heisst "${question.target.de}"`);
                }
            };

            if(!question) return <div>Lade...</div>;

            return (
                <div className="max-w-lg mx-auto text-center">
                    <div className="bg-white p-8 rounded-3xl shadow-lg mb-6 border-t-8 border-indigo-500">
                        <p className="text-slate-400 text-sm font-bold uppercase mb-2">Was heisst das?</p>
                        <h1 className="text-4xl font-black text-indigo-900 mb-4">{question.target.fr}</h1>
                        <button onClick={() => speak(question.target.fr)} className="bg-indigo-100 text-indigo-600 px-4 py-1 rounded-full text-sm font-bold mb-4">üîä Anh√∂ren</button>
                    </div>
                    <div className="grid gap-3">
                        {question.options.map((opt, i) => (
                            <button key={i} onClick={() => check(opt)} className="quiz-btn hover:bg-indigo-50 hover:border-indigo-300">
                                {opt.de}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // 3. SCHREIB GAME
        const WriteGame = ({ onCorrect }) => {
            const [target, setTarget] = useState(null);
            const [input, setInput] = useState("");

            const next = () => {
                const t = VOCABULARY[Math.floor(Math.random() * VOCABULARY.length)];
                setTarget(t);
                setInput("");
                speak(t.fr);
            };

            useEffect(() => next(), []);

            const check = () => {
                if(input.toLowerCase().trim() === target.de.toLowerCase().split(' (')[0].toLowerCase()) {
                    onCorrect();
                    next();
                } else {
                    alert(`Fast! Die L√∂sung ist: ${target.de}`);
                }
            };

            if(!target) return null;

            return (
                <div className="max-w-lg mx-auto text-center">
                    <div className="bg-white p-8 rounded-3xl shadow-lg mb-6 border-t-8 border-emerald-500">
                        <p className="text-slate-400 text-sm font-bold uppercase mb-2">Schreibe auf Deutsch</p>
                        <h1 className="text-4xl font-black text-emerald-900 mb-4">{target.fr}</h1>
                        <button onClick={() => speak(target.fr)} className="bg-emerald-100 text-emerald-600 px-4 py-1 rounded-full text-sm font-bold">üîä Anh√∂ren</button>
                    </div>
                    <input 
                        value={input} onChange={e => setInput(e.target.value)} 
                        className="w-full p-4 text-center text-xl border-4 border-emerald-100 rounded-2xl focus:border-emerald-400 outline-none mb-4"
                        placeholder="√úbersetzung..."
                        onKeyDown={e => e.key === 'Enter' && check()}
                        autoFocus
                    />
                    <button onClick={check} className="w-full bg-emerald-600 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition">
                        Pr√ºfen
                    </button>
                </div>
            );
        };

        // --- APP SHELL ---
        const App = () => {
            const [user, setUser] = useState({ name: 'Gast', coins: 0, xp: 0, level: 1, avatar: 'bear', unlockedAvatars: ['bear'] });
            const [view, setView] = useState('menu'); // menu, memory, quiz, write, shop

            useEffect(() => {
                const s = localStorage.getItem('franz_user_final');
                if (s) setUser(JSON.parse(s));
            }, []);

            const save = (u) => {
                setUser(u);
                localStorage.setItem('franz_user_final', JSON.stringify(u));
            };

            const addProgress = (c, x) => {
                const u = { ...user };
                u.coins += c; u.xp += x;
                if (u.xp >= LEVELS[u.level]) { u.level++; alert("LEVEL UP! üá´üá∑"); safeConfetti(); }
                save(u);
                if(c > 5) safeConfetti(); // Confetti bei grossen Gewinnen
            };

            // --- MEN√ú SCREEN ---
            if (view === 'menu') return (
                <div className="min-h-screen p-4 max-w-4xl mx-auto">
                    <header className="bg-white p-4 rounded-3xl shadow-sm mb-8 flex justify-between items-center">
                        <div className="flex items-center gap-3">
                            <div className="text-4xl bg-indigo-50 p-2 rounded-xl">{AVATARS.find(a=>a.id===user.avatar)?.icon}</div>
                            <div>
                                <div className="font-bold text-lg text-indigo-900">{user.name}</div>
                                <div className="text-xs text-slate-400 font-bold">Lvl {user.level}</div>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <a href="index.html" className="bg-slate-100 text-slate-500 px-4 py-2 rounded-xl font-bold hover:bg-slate-200">üè†</a>
                            <button onClick={()=>setView('shop')} className="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-xl font-bold flex items-center gap-2 shadow-sm hover:scale-105 transition">
                                <span>{user.coins}</span> üí∞
                            </button>
                        </div>
                    </header>

                    <h1 className="text-center text-4xl font-black text-indigo-900 mb-8">Salut! Was √ºben wir?</h1>

                    <div className="grid gap-4 max-w-md mx-auto">
                        <button onClick={()=>setView('memory')} className="bg-white p-6 rounded-2xl shadow-sm border-l-8 border-blue-500 hover:shadow-lg transition flex items-center gap-4 text-left group">
                            <div className="text-4xl bg-blue-50 w-16 h-16 flex items-center justify-center rounded-xl group-hover:scale-110 transition">üÉè</div>
                            <div>
                                <div className="font-bold text-xl text-slate-800">Memory</div>
                                <div className="text-sm text-slate-500">Finde die Paare (Blau & Orange)</div>
                            </div>
                        </button>

                        <button onClick={()=>setView('quiz')} className="bg-white p-6 rounded-2xl shadow-sm border-l-8 border-indigo-500 hover:shadow-lg transition flex items-center gap-4 text-left group">
                            <div className="text-4xl bg-indigo-50 w-16 h-16 flex items-center justify-center rounded-xl group-hover:scale-110 transition">‚ùì</div>
                            <div>
                                <div className="font-bold text-xl text-slate-800">Quiz</div>
                                <div className="text-sm text-slate-500">W√§hle die richtige L√∂sung</div>
                            </div>
                        </button>

                        <button onClick={()=>setView('write')} className="bg-white p-6 rounded-2xl shadow-sm border-l-8 border-emerald-500 hover:shadow-lg transition flex items-center gap-4 text-left group">
                            <div className="text-4xl bg-emerald-50 w-16 h-16 flex items-center justify-center rounded-xl group-hover:scale-110 transition">‚úçÔ∏è</div>
                            <div>
                                <div className="font-bold text-xl text-slate-800">Schreiben</div>
                                <div className="text-sm text-slate-500">Tippe das deutsche Wort</div>
                            </div>
                        </button>
                    </div>
                </div>
            );

            // --- SHOP SCREEN ---
            if (view === 'shop') return (
                <div className="min-h-screen bg-yellow-50 p-4">
                    <div className="max-w-2xl mx-auto">
                        <div className="flex justify-between items-center mb-6">
                            <button onClick={()=>setView('menu')} className="font-bold text-slate-500">‚óÄ Zur√ºck</button>
                            <div className="font-bold text-xl text-yellow-600">{user.coins} üí∞</div>
                        </div>
                        <h1 className="text-3xl font-black text-slate-800 mb-6 text-center">Avatar Shop</h1>
                        <div className="grid grid-cols-3 md:grid-cols-4 gap-3">
                            {AVATARS.map(a => {
                                const owned = user.unlockedAvatars.includes(a.id);
                                return (
                                    <button key={a.id} disabled={!owned && user.coins<a.cost} 
                                        onClick={()=>{ if(!owned) { save({...user, coins:user.coins-a.cost, unlockedAvatars:[...user.unlockedAvatars, a.id], avatar:a.id}); safeConfetti(); } else save({...user, avatar:a.id}); }}
                                        className={`bg-white p-4 rounded-2xl flex flex-col items-center shadow-sm ${!owned ? 'opacity-50' : user.avatar===a.id ? 'ring-4 ring-green-400' : ''}`}>
                                        <span className="text-4xl mb-2">{a.icon}</span>
                                        {!owned && <span className="text-xs font-bold bg-yellow-100 px-2 rounded text-yellow-800">{a.cost} üí∞</span>}
                                    </button>
                                )
                            })}
                        </div>
                    </div>
                </div>
            );

            // --- GAME CONTAINER ---
            return (
                <div className="min-h-screen p-4 flex flex-col">
                    <div className="flex justify-between items-center max-w-4xl mx-auto w-full mb-6">
                        <button onClick={()=>setView('menu')} className="bg-white px-4 py-2 rounded-xl font-bold shadow text-slate-500">üè† Men√º</button>
                        <div className="font-bold text-indigo-600 bg-indigo-100 px-4 py-2 rounded-xl">{user.coins} üí∞</div>
                    </div>

                    <div className="flex-1 flex flex-col justify-center">
                        {view === 'memory' && <MemoryGame onFinish={() => addProgress(20, 50)} />}
                        {view === 'quiz' && <QuizGame onCorrect={() => addProgress(5, 10)} />}
                        {view === 'write' && <WriteGame onCorrect={() => addProgress(10, 20)} />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>