<!DOCTYPE html>
<html lang="de-CH">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Franz√∂sisch Infinity</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700&display=swap');
        
        /* STANDARD FARBEN (Werden durch Themes √ºberschrieben) */
        :root { 
            --bg-color: #eef2ff; 
            --primary: #4f46e5; 
            --text: #312e81; 
            --card-bg: #ffffff;
        }
        
        /* THEMES */
        .theme-dark { --bg-color: #0f172a; --primary: #818cf8; --text: #f1f5f9; --card-bg: #1e293b; }
        .theme-pink { --bg-color: #fdf2f8; --primary: #db2777; --text: #831843; --card-bg: #fff1f2; }
        .theme-green { --bg-color: #f0fdf4; --primary: #16a34a; --text: #14532d; --card-bg: #dcfce7; }
        .theme-gold { --bg-color: #fffbeb; --primary: #d97706; --text: #78350f; --card-bg: #fef3c7; }
        
        body { 
            font-family: 'Fredoka', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text); 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s, color 0.5s;
        }
        .nunito { font-family: 'Nunito', sans-serif; }
        
        /* Card Styles */
        .word-card {
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            text-align: center; font-size: 1.1rem; font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1); cursor: pointer; transition: all 0.1s;
            min-height: 90px; position: relative; overflow: hidden;
            background-color: var(--card-bg);
        }
        .word-card:active { transform: translateY(4px); box-shadow: 0 0 0 transparent; }
        
        /* Spezifische Farben bleiben erhalten f√ºr Erkennbarkeit */
        .card-fr { border: 2px solid #bfdbfe; color: #1e3a8a; }
        .theme-dark .card-fr { background: #172554; border-color: #1e40af; color: #bfdbfe; }
        
        .card-fr.selected { background: #2563eb !important; border-color: #1d4ed8 !important; color: white !important; }
        
        .card-de { border: 2px solid #fed7aa; color: #7c2d12; }
        .theme-dark .card-de { background: #431407; border-color: #7c2d12; color: #fed7aa; }
        
        .card-de.selected { background: #ea580c !important; border-color: #c2410c !important; color: white !important; }

        .word-card.matched { transform: scale(0); opacity: 0; transition: all 0.5s; pointer-events: none; }
        .word-card.wrong { animation: shake 0.4s; border-color: #ef4444; background: #fee2e2; }

        .flag-icon { font-size: 0.8rem; position: absolute; top: 4px; right: 6px; opacity: 0.7; }
        
        /* Animations */
        @keyframes shake { 10%, 90% { transform: translateX(-2px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }
        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* Shop & Avatar */
        .avatar-card { transition: all 0.2s; border: 2px solid transparent; background-color: var(--card-bg); }
        .avatar-card:active { transform: scale(0.95); }
        .avatar-card.selected { border-color: #22c55e; box-shadow: 0 0 15px rgba(34, 197, 94, 0.3); }
        
        /* Quiz Button */
        .quiz-btn {
            background: var(--card-bg); border: 2px solid #e0e7ff; border-radius: 16px; padding: 20px;
            font-weight: bold; text-align: left; box-shadow: 0 4px 0 #c7d2fe;
            transition: all 0.2s; font-size: 1.2rem;
        }
        .theme-dark .quiz-btn { border-color: #475569; box-shadow: 0 4px 0 #334155; }
        .quiz-btn:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DATENBANK ---
        const LEVELS = [0, 100, 300, 600, 1000, 1500, 2200, 3000, 4000, 5000, 10000];
        
        const AVATARS = [
            { id: 'bear', icon: 'üêª', name: 'Bruno', cost: 0, rarity: 'common' },
            { id: 'cat', icon: 'üê±', name: 'Mimi', cost: 50, rarity: 'common' },
            { id: 'fox', icon: 'ü¶ä', name: 'Foxy', cost: 250, rarity: 'rare' },
            { id: 'lion', icon: 'ü¶Å', name: 'Leo', cost: 600, rarity: 'rare' },
            { id: 'robot', icon: 'ü§ñ', name: 'Robo', cost: 1500, rarity: 'epic' },
            { id: 'alien', icon: 'üëΩ', name: 'Zorg', cost: 2000, rarity: 'epic' },
            { id: 'unicorn', icon: 'ü¶Ñ', name: 'Sparkle', cost: 8000, rarity: 'legendary' },
            { id: 'king', icon: 'üëë', name: 'King', cost: 25000, rarity: 'legendary' }
        ];

        const THEMES = [
            { id: 'default', name: 'Standard', cost: 0, class: '' },
            { id: 'dark', name: 'Nacht', cost: 500, class: 'theme-dark' },
            { id: 'pink', name: 'Candy', cost: 1000, class: 'theme-pink' },
            { id: 'green', name: 'Dschungel', cost: 1000, class: 'theme-green' },
            { id: 'gold', name: 'Luxus', cost: 5000, class: 'theme-gold' }
        ];

        const VOCABULARY = [
            { fr: "Bonjour", de: "Guten Tag" }, { fr: "Salut", de: "Hallo" }, { fr: "Au revoir", de: "Auf Wiedersehen" },
            { fr: "√áa va?", de: "Wie geht es?" }, { fr: "Merci", de: "Danke" }, { fr: "S'il vous pla√Æt", de: "Bitte" },
            { fr: "Je", de: "Ich" }, { fr: "Tu", de: "Du" }, { fr: "Il", de: "Er" }, { fr: "Elle", de: "Sie" },
            { fr: "Nous", de: "Wir" }, { fr: "Vous", de: "Ihr" }, { fr: "Ils", de: "Sie (Mehrzahl)" },
            { fr: "Et", de: "Und" }, { fr: "Ou", de: "Oder" }, { fr: "Mais", de: "Aber" }, { fr: "Oui", de: "Ja" }, { fr: "Non", de: "Nein" },
            { fr: "D'abord", de: "Zuerst" }, { fr: "Puis", de: "Dann" }, { fr: "Apr√®s", de: "Danach" }, { fr: "Finalement", de: "Schliesslich" },
            { fr: "Peut-√™tre", de: "Vielleicht" }, { fr: "Toujours", de: "Immer" }, { fr: "Jamais", de: "Nie" },
            { fr: "L'√©cole", de: "Die Schule" }, { fr: "Le livre", de: "Das Buch" }, { fr: "Le cahier", de: "Das Heft" },
            { fr: "Le crayon", de: "Der Bleistift" }, { fr: "La gomme", de: "Der Gummi" }, { fr: "Le chien", de: "Der Hund" }, 
            { fr: "La maison", de: "Das Haus" }, { fr: "La fen√™tre", de: "Das Fenster" }, { fr: "La porte", de: "Die T√ºr" },
            { fr: "Rouge", de: "Rot" }, { fr: "Bleu", de: "Blau" }, { fr: "Vert", de: "Gr√ºn" }, { fr: "Jaune", de: "Gelb" },
            { fr: "Noir", de: "Schwarz" }, { fr: "Blanc", de: "Weiss" }, 
            { fr: "Un", de: "Eins" }, { fr: "Deux", de: "Zwei" }, { fr: "Trois", de: "Drei" }, { fr: "Quatre", de: "Vier" },
            { fr: "Cinq", de: "F√ºnf" }, { fr: "Six", de: "Sechs" }, { fr: "Sept", de: "Sieben" }, { fr: "Huit", de: "Acht" },
            { fr: "Neuf", de: "Neun" }, { fr: "Dix", de: "Zehn" }
        ];

        // --- HELPER ---
        const speak = (txt) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'fr-FR'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        };

        const safeConfetti = () => { if (window.confetti) window.confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); };

        // --- COMPONENTS ---
        
        // 1. MEMORY GAME
        const MemoryGame = ({ onFinish }) => {
            const [cards, setCards] = useState([]);
            const [selected, setSelected] = useState(null);
            const [matches, setMatches] = useState(0);
            const [wrongPair, setWrongPair] = useState([]);

            useEffect(() => {
                const selection = [...VOCABULARY].sort(() => Math.random() - 0.5).slice(0, 6);
                const deck = [];
                selection.forEach(pair => {
                    deck.push({ id: pair.fr, txt: pair.fr, type: 'fr', pairId: pair.fr });
                    deck.push({ id: pair.fr + '_de', txt: pair.de, type: 'de', pairId: pair.fr });
                });
                setCards(deck.sort(() => Math.random() - 0.5));
            }, []);

            const handleCardClick = (card) => {
                if (card.matched || wrongPair.length > 0 || (selected && selected.id === card.id)) return;
                if (card.type === 'fr') speak(card.txt);
                if (!selected) { setSelected(card); return; }

                if (selected.pairId === card.pairId) {
                    setCards(cards.map(c => (c.id === card.id || c.id === selected.id) ? { ...c, matched: true } : c));
                    setSelected(null); setMatches(m => m + 1);
                    if (matches + 1 === 6) setTimeout(onFinish, 1000);
                } else {
                    setWrongPair([selected.id, card.id]);
                    setTimeout(() => { setWrongPair([]); setSelected(null); }, 1000);
                }
            };

            return (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    {cards.map((c, i) => (
                        <div key={i} onClick={() => handleCardClick(c)} 
                            className={`word-card ${c.type==='fr'?'card-fr':'card-de'} ${selected?.id===c.id ? 'selected' : ''} ${wrongPair.includes(c.id) ? 'wrong' : ''} ${c.matched ? 'matched' : ''}`}>
                            <span className="flag-icon">{c.type === 'fr' ? 'üá´üá∑' : 'üá©üá™'}</span>{c.txt}
                        </div>
                    ))}
                </div>
            );
        };

        // 2. QUIZ GAME
        const QuizGame = ({ onCorrect }) => {
            const [question, setQuestion] = useState(null);
            const nextQ = () => {
                const target = VOCABULARY[Math.floor(Math.random() * VOCABULARY.length)];
                const distractors = VOCABULARY.filter(w => w.fr !== target.fr).sort(() => Math.random() - 0.5).slice(0, 3);
                const options = [...distractors, target].sort(() => Math.random() - 0.5);
                setQuestion({ target, options });
                speak(target.fr);
            };
            useEffect(() => nextQ(), []);

            const check = (opt) => {
                if(opt.fr === question.target.fr) { onCorrect(); nextQ(); }
                else alert(`Falsch! ${question.target.fr} heisst "${question.target.de}"`);
            };
            if(!question) return <div>Lade...</div>;

            return (
                <div className="max-w-lg mx-auto text-center pop-in">
                    <div className="word-card mb-6 border-4 border-indigo-500 flex-col py-8">
                        <p className="text-slate-400 text-sm font-bold uppercase mb-2">Was heisst das?</p>
                        <h1 className="text-4xl font-black text-indigo-900 mb-4">{question.target.fr}</h1>
                        <button onClick={() => speak(question.target.fr)} className="bg-indigo-100 text-indigo-600 px-4 py-2 rounded-full font-bold hover:bg-indigo-200 transition">üîä Anh√∂ren</button>
                    </div>
                    <div className="grid gap-3">
                        {question.options.map((opt, i) => (
                            <button key={i} onClick={() => check(opt)} className="quiz-btn hover:opacity-80">
                                {opt.de}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // 3. WRITE GAME
        const WriteGame = ({ onCorrect }) => {
            const [target, setTarget] = useState(null);
            const [input, setInput] = useState("");
            const next = () => {
                const t = VOCABULARY[Math.floor(Math.random() * VOCABULARY.length)];
                setTarget(t); setInput(""); speak(t.fr);
            };
            useEffect(() => next(), []);

            const check = () => {
                if(input.toLowerCase().trim() === target.de.toLowerCase().split(' (')[0].toLowerCase()) { onCorrect(); next(); }
                else alert(`Fast! Die L√∂sung ist: ${target.de}`);
            };
            if(!target) return null;

            return (
                <div className="max-w-lg mx-auto text-center pop-in">
                    <div className="word-card mb-6 border-4 border-emerald-500 flex-col py-8">
                        <p className="text-slate-400 text-sm font-bold uppercase mb-2">Schreibe auf Deutsch</p>
                        <h1 className="text-4xl font-black text-emerald-900 mb-4">{target.fr}</h1>
                        <button onClick={() => speak(target.fr)} className="bg-emerald-100 text-emerald-600 px-4 py-2 rounded-full font-bold hover:bg-emerald-200">üîä Anh√∂ren</button>
                    </div>
                    <input value={input} onChange={e => setInput(e.target.value)} className="w-full p-4 text-center text-xl border-4 border-emerald-100 rounded-2xl focus:border-emerald-400 outline-none mb-4" placeholder="√úbersetzung..." onKeyDown={e => e.key === 'Enter' && check()} autoFocus />
                    <button onClick={check} className="w-full bg-emerald-600 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition text-xl">Pr√ºfen</button>
                </div>
            );
        };

        // --- APP SHELL ---
        const App = () => {
            const [user, setUser] = useState({ name: 'Gast', coins: 0, xp: 0, level: 1, avatar: 'bear', unlockedAvatars: ['bear'], theme: 'default' });
            const [view, setView] = useState('menu');

            useEffect(() => { const s = localStorage.getItem('franz_user_master'); if (s) setUser(JSON.parse(s)); }, []);
            const save = (u) => { setUser(u); localStorage.setItem('franz_user_master', JSON.stringify(u)); };

            // THEME APPLIER
            useEffect(() => {
                const theme = THEMES.find(t => t.id === user.theme) || THEMES[0];
                document.body.className = `min-h-screen ${theme.class}`;
            }, [user.theme]);

            const addProgress = (c, x) => {
                const u = { ...user }; u.coins += c; u.xp += x;
                if (u.xp >= LEVELS[u.level]) { u.level++; alert("NIVEAU SUP√âRIEUR! (Level Up) üéâ"); safeConfetti(); }
                save(u); if(c > 5) safeConfetti();
            };

            const buyAvatar = (av) => {
                if (!user.unlockedAvatars.includes(av.id)) {
                    if (user.coins >= av.cost) {
                        const u = { ...user }; u.coins -= av.cost; u.unlockedAvatars.push(av.id); u.avatar = av.id;
                        save(u); safeConfetti();
                    }
                } else { save({ ...user, avatar: av.id }); }
            };

            if (view === 'menu') {
                return (
                    <div className="max-w-md mx-auto p-4 min-h-screen flex flex-col justify-center">
                        <div className="word-card flex-col p-8 mb-6 border-b-8 border-indigo-200">
                            <div className="w-full flex justify-between items-center mb-8 bg-slate-50 p-3 rounded-2xl">
                                 <div className="flex items-center gap-3">
                                    <div className="text-4xl bg-white p-2 rounded-xl shadow-sm">{AVATARS.find(a=>a.id===user.avatar)?.icon || 'üêª'}</div>
                                    <div className="text-left"><div className="font-bold text-indigo-900">{user.name}</div><div className="text-xs text-indigo-400 font-bold">Level {user.level}</div></div>
                                 </div>
                                 <button onClick={() => setView('shop')} className="bg-yellow-100 text-yellow-700 px-4 py-2 rounded-xl font-bold text-sm hover:bg-yellow-200 transition shadow-sm">{user.coins} üí∞</button>
                            </div>
                            <h1 className="text-4xl font-black text-indigo-600 mb-2">Franz√∂sisch</h1>
                            <p className="text-slate-400 mb-8 font-bold uppercase tracking-widest text-xs">Vokabel Trainer Ultimate</p>

                            <div className="w-full space-y-3">
                                <button onClick={()=>setView('memory')} className="w-full bg-indigo-50 p-4 rounded-2xl hover:bg-indigo-100 transition flex items-center gap-4 text-left border border-indigo-100 group">
                                    <div className="text-3xl bg-white w-12 h-12 flex items-center justify-center rounded-xl shadow-sm group-hover:scale-110 transition">üÉè</div>
                                    <div><div className="font-bold text-indigo-900">Memory</div><div className="text-xs text-slate-500">Finde die Paare</div></div>
                                </button>
                                <button onClick={()=>setView('quiz')} className="w-full bg-indigo-50 p-4 rounded-2xl hover:bg-indigo-100 transition flex items-center gap-4 text-left border border-indigo-100 group">
                                    <div className="text-3xl bg-white w-12 h-12 flex items-center justify-center rounded-xl shadow-sm group-hover:scale-110 transition">‚ùì</div>
                                    <div><div className="font-bold text-indigo-900">Quiz</div><div className="text-xs text-slate-500">W√§hle die L√∂sung</div></div>
                                </button>
                                <button onClick={()=>setView('write')} className="w-full bg-indigo-50 p-4 rounded-2xl hover:bg-indigo-100 transition flex items-center gap-4 text-left border border-indigo-100 group">
                                    <div className="text-3xl bg-white w-12 h-12 flex items-center justify-center rounded-xl shadow-sm group-hover:scale-110 transition">‚úçÔ∏è</div>
                                    <div><div className="font-bold text-indigo-900">Schreiben</div><div className="text-xs text-slate-500">Diktat Training</div></div>
                                </button>
                            </div>

                            <a href="index.html" className="block w-full bg-slate-100 text-slate-500 font-bold py-3 rounded-xl hover:bg-slate-200 transition mt-8 text-sm">üè† Zur√ºck zur Zentrale</a>
                        </div>
                    </div>
                );
            }

            if (view === 'shop') return (
                <div className="max-w-2xl mx-auto p-4 min-h-screen">
                    <div className="flex justify-between items-center mb-6 word-card p-4">
                        <button onClick={() => setView('menu')} className="text-slate-500 font-bold">‚óÄ Zur√ºck</button>
                        <div className="font-bold text-xl text-yellow-600">{user.coins} üí∞</div>
                    </div>
                    
                    <div className="grid grid-cols-3 md:grid-cols-4 gap-3 mb-8">
                        {AVATARS.map(a => {
                            const owned = (user.unlockedAvatars || ['bear']).includes(a.id);
                            const selected = user.avatar === a.id;
                            return (
                                <button key={a.id} disabled={!owned && user.coins<a.cost} 
                                    onClick={()=>{ if(!owned) { save({...user, coins:user.coins-a.cost, unlockedAvatars:[...(user.unlockedAvatars||['bear']), a.id], avatar:a.id}); safeConfetti(); } else save({...user, avatar:a.id}); }} 
                                    className={`bg-white p-4 rounded-2xl flex flex-col items-center shadow-sm item-card border-4 ${selected ? 'border-green-400 bg-green-50' : `rarity-${a.rarity}`} ${!owned && user.coins<a.cost ? 'opacity-50 grayscale' : ''}`}>
                                    <span className="text-4xl mb-2">{a.icon}</span>
                                    {!owned && <span className="text-xs font-bold bg-yellow-100 px-2 rounded text-yellow-800">{a.cost}</span>}
                                    {owned && <span className="text-xs font-bold text-green-600 uppercase">Besitz</span>}
                                </button>
                            )
                        })}
                    </div>
                    
                    <h3 className="font-bold text-center mb-4 uppercase tracking-widest opacity-50">Designs</h3>
                    <div className="grid grid-cols-2 gap-3">
                        {THEMES.map(t => (
                            <button key={t.id} onClick={()=>{ save({...user, theme:t.id}); }} className={`p-4 rounded-xl font-bold border-2 ${user.theme===t.id ? 'border-green-500 bg-green-50' : 'border-slate-200 bg-white'}`}>
                                {t.name} {t.cost > 0 && <span className="text-xs bg-yellow-100 px-2 rounded">{t.cost}</span>}
                            </button>
                        ))}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen p-4 flex flex-col">
                    <div className="flex justify-between items-center max-w-4xl mx-auto w-full mb-6">
                        <button onClick={()=>setView('menu')} className="bg-white px-4 py-2 rounded-xl font-bold shadow text-slate-500">üè† Men√º</button>
                        <div className="font-bold text-indigo-600 bg-indigo-100 px-4 py-2 rounded-xl">{user.coins} üí∞</div>
                    </div>
                    <div className="flex-1 flex flex-col justify-center">
                        {view === 'memory' && <MemoryGame onFinish={() => addProgress(20, 50)} />}
                        {view === 'quiz' && <QuizGame onCorrect={() => addProgress(5, 10)} />}
                        {view === 'write' && <WriteGame onCorrect={() => addProgress(10, 20)} />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>