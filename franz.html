<!DOCTYPE html>
<html lang="de-CH">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FranzÃ¶sisch Lernen â€“ Campus 4. Klasse</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background: linear-gradient(180deg, #dbeafe, #eff6ff);
            font-family: 'Nunito', sans-serif;
        }
        .card {
            background: white;
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: 0.2s;
        }
        .card:hover {
            transform: scale(1.03);
        }
        .memory-card {
            width: 100px;
            height: 100px;
            background: #bfdbfe;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            transition: 0.2s;
        }
        .memory-card.flipped {
            background: #2563eb;
            color: white;
        }
        .choice-btn {
            background: white;
            border-radius: 12px;
            padding: 14px;
            border: 2px solid #93c5fd;
            transition: 0.2s;
            cursor: pointer;
        }
        .choice-btn:hover {
            background: #bfdbfe;
        }
    </style>
</head>

<body class="p-6">

    <h1 class="text-4xl font-black text-center mb-6">ðŸ‡«ðŸ‡· FranzÃ¶sisch Abenteuer</h1>

    <div id="app" class="max-w-3xl mx-auto"></div>


    <!-- ===========================
              JAVASCRIPT
         =========================== -->
    <script>
    let VOCAB = [];
    let VERBS = [];
    let NUMBERS = [];
    let PLACES = [];
    let DICTIONARY = {};

    /* ===========================
        1) ALLE JSON DATEIEN LADEN
    ============================ */
    async function loadAll() {
        const vocab = await fetch("data/franz_vocab.json").then(r => r.json());
        const verbs = await fetch("data/franz_verbs.json").then(r => r.json());
        const numbers = await fetch("data/franz_numbers.json").then(r => r.json());
        const places = await fetch("data/franz_places.json").then(r => r.json());

        VOCAB = vocab.worlds;
        VERBS = verbs.verbs;
        NUMBERS = numbers.numbers;
        PLACES = places.places;

        // Dictionary zusammenbauen
        DICTIONARY = {};

        VOCAB.forEach(world =>
            world.words.forEach(w => DICTIONARY[w.fr] = w.de)
        );

        PLACES.forEach(p => DICTIONARY[p.fr] = p.de);
        NUMBERS.forEach(n => DICTIONARY[n.fr] = n.de);

        VERBS.forEach(v => {
            DICTIONARY[v.infinitive] = v.de;
            Object.entries(v.conjugation).forEach(([pron, form]) => {
                DICTIONARY[form] = v.de + " (" + pron + ")";
            });
        });

        renderMenu();
    }


    /* ===========================
        2) HAUPTMENÃœ
    ============================ */
    function renderMenu() {
        const app = document.getElementById("app");

        let html = `
            <h2 class="text-xl font-bold mb-4">WÃ¤hle dein Spiel</h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                <div class="card" onclick="startMemory()">
                    ðŸ§  <b>Memory</b><br>
                    Finde passende Kartenpaare.
                </div>

                <div class="card" onclick="startMultipleChoice()">
                    ðŸŽ¯ <b>Multiple Choice</b><br>
                    WÃ¤hle die richtige deutsche Bedeutung.
                </div>

                <div class="card" onclick="startListening()">
                    ðŸ”Š <b>HÃ¶ren</b><br>
                    HÃ¶re das Wort und wÃ¤hle die richtige Bedeutung.
                </div>

            </div>
        `;

        app.innerHTML = html;
    }


    /* ===========================
        3) MEMORY SPIEL
    ============================ */
    function startMemory() {
        const app = document.getElementById("app");

        // WÃ¶rter mischen
        let allWords = Object.entries(DICTIONARY).slice(0, 8);
        let cards = [];

        allWords.forEach(([fr, de]) => {
            cards.push({ text: fr, lang: "fr" });
            cards.push({ text: de, lang: "de" });
        });

        cards = shuffle(cards);

        let html = `
            <h2 class="text-xl font-bold mb-4">ðŸ§  Memory</h2>
            <div class="grid grid-cols-4 gap-3">
        `;

        cards.forEach((card, i) => {
            html += `
                <div class="memory-card" onclick="flip(${i})" id="card-${i}">
                    ?
                </div>
            `;
        });

        html += `</div><br><button class="mt-6 px-4 py-2 bg-blue-600 text-white" onclick="renderMenu()">ZurÃ¼ck</button>`;

        app.innerHTML = html;

        window.memoryCards = cards;
        window.memoryOpen = [];
    }

    function flip(i) {
        const el = document.getElementById("card-" + i);
        let card = memoryCards[i];

        if (el.classList.contains("flipped")) return;
        el.classList.add("flipped");
        el.innerHTML = card.text;

        memoryOpen.push(i);

        if (memoryOpen.length === 2) {
            const [a, b] = memoryOpen;

            let cardA = memoryCards[a];
            let cardB = memoryCards[b];

            let match =
                (DICTIONARY[cardA.text] === cardB.text) ||
                (DICTIONARY[cardB.text] === cardA.text);

            if (!match) {
                setTimeout(() => {
                    document.getElementById("card-" + a).classList.remove("flipped");
                    document.getElementById("card-" + a).innerHTML = "?";

                    document.getElementById("card-" + b).classList.remove("flipped");
                    document.getElementById("card-" + b).innerHTML = "?";
                }, 700);
            }

            memoryOpen = [];
        }
    }


    /* ===========================
        4) MULTIPLE CHOICE SPIEL
    ============================ */
    function startMultipleChoice() {
        const app = document.getElementById("app");

        let words = shuffle(Object.entries(DICTIONARY)).slice(0, 10);

        let html = `<h2 class="text-xl font-bold mb-4">ðŸŽ¯ Multiple Choice</h2>`;

        words.forEach(([fr, de]) => {
            // Falsche Antworten wÃ¤hlen
            let wrong = shuffle(Object.values(DICTIONARY).filter(x => x !== de)).slice(0, 2);
            let choices = shuffle([de, ...wrong]);

            html += `<div class="mb-4 p-3 border rounded-lg bg-white shadow">
                        <b>${fr}</b><br>
                        ${choices.map(c =>
                            `<div class="choice-btn mt-2" onclick="checkChoice('${de}','${c}', this)">
                                ${c}
                            </div>`
                        ).join("")}
                     </div>`;
        });

        html += `<button class="mt-6 px-4 py-2 bg-blue-600 text-white" onclick="renderMenu()">ZurÃ¼ck</button>`;

        app.innerHTML = html;
    }

    function checkChoice(correct, chosen, el) {
        if (correct === chosen) {
            el.style.background = "#4ade80";
        } else {
            el.style.background = "#f87171";
        }
    }


    /* ===========================
        5) HÃ–R-SPIEL
    ============================ */
    function startListening() {
        const app = document.getElementById("app");

        let words = shuffle(Object.entries(DICTIONARY)).slice(0, 8);

        let html = `
            <h2 class="text-xl font-bold mb-4">ðŸ”Š HÃ¶r zu</h2>
            <p class="mb-4">Klicke auf den Lautsprecher und wÃ¤hle die richtige Bedeutung.</p>
        `;

        words.forEach(([fr, de]) => {
            let wrong = shuffle(Object.values(DICTIONARY).filter(x => x !== de)).slice(0, 2);
            let choices = shuffle([de, ...wrong]);

            html += `
                <div class="mb-4 p-4 border rounded bg-white">
                    <button class="px-3 py-2 bg-blue-600 text-white rounded" onclick="speak('${fr}')">ðŸ”Š AnhÃ¶ren</button>
                    <div class="mt-2">
                        ${choices.map(c =>
                            `<div class="choice-btn mt-2" onclick="checkChoice('${de}','${c}', this)">
                                ${c}
                            </div>`
                        ).join("")}
                    </div>
                </div>
            `;
        });

        html += `<button class="mt-6 px-4 py-2 bg-blue-600 text-white" onclick="renderMenu()">ZurÃ¼ck</button>`;

        app.innerHTML = html;
    }

    function speak(text) {
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = "fr-FR";
        speechSynthesis.speak(msg);
    }


    /* ===========================
        HILFSFUNKTIONEN
    ============================ */
    function shuffle(arr) {
        return arr.sort(() => Math.random() - 0.5);
    }

    // App starten
    loadAll();

    </script>

</body>
</html>
